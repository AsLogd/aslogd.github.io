var CONST={FADE_CLASS:"faded",HIDE_CLASS:"hidden",VEIL_CLASS:"veil",VEILED_CLASS:"veiled",SELECTED_CLASS:"selected",ACTIVE_CLASS:"active",HAPPENING_CLASS:"happening",HAPPENED_CLASS:"happened",SCHEDULE_STEP:3600,FADE_TIME:300,ASIDE_OPEN_TIME:300,REQ_TIMEOUT:2e3,SCHEDULE_REFRESH_INTERVAL:6e4,DEFAULT_VIEW:"live",HACKATHON_DURATION:129600,DEFAULT_NOTIFICATION_TITLE:"HackUPC Winter 2017",DEFAULT_NOTIFICATION_ICON:"favicon.ico",NOTIFICATION_TIMEOUT:7e3,EVENT_NOTIF_OFFSET:300},Util=function(e){"use strict";if(!e)return console.error("CONST module not found at this point"),null;var t={};return t.loadFile=function(t,n,o){var i=new XMLHttpRequest;i.onload=function(){4===this.readyState&&(200===this.status?"function"==typeof n&&n(this.responseText):"function"==typeof n&&o(this.statusText))},i.onerror=function(){"function"==typeof n&&o(this.statusText)},i.open("GET",t,!0),i.timeout=e.REQ_TIMEOUT,i.send(null)},t.fadeOut=function(t,n){t.classList.add(e.FADE_CLASS),setTimeout(function(){"function"==typeof n&&n()},e.FADE_TIME)},t.fadeIn=function(t,n){t.classList.remove(e.FADE_CLASS),setTimeout(function(){"function"==typeof n&&n()},e.FADE_TIME)},t.hide=function(t){t.classList.add(e.HIDE_CLASS)},t.show=function(t){t.classList.remove(e.HIDE_CLASS)},t.veil=function(t,n){t.classList.add(e.VEIL_CLASS),setTimeout(function(){t.classList.add(e.VEILED_CLASS)},1),setTimeout(function(){"function"==typeof n&&n()},e.FADE_TIME)},t.unveil=function(t,n){t.classList.remove(e.VEILED_CLASS),setTimeout(function(){t.classList.remove(e.VEIL_CLASS),"function"==typeof n&&n()},e.FADE_TIME)},t.blockScroll=function(e){e.style.overflow="hidden"},t.releaseScroll=function(e){e.style.overflow="auto"},t.pad=function(e){return("0"+e).slice(-2)},t.hourToSeconds=function(e){var t=e.split(":");return 60*t[0]*60+60*t[1]},t.dateToSeconds=function(e){var t=e.split(" "),n=[0,0],o=t[0].split("/")||[0,0,0];return t.length>1&&(n=t[1].split(":")),Date.UTC(o[2],o[1]-1,o[0],n[0],n[1])/1e3},t.getNowSeconds=function(){return Date.now()/1e3},t.getHumanTime=function(e){return{seconds:parseInt(e%60),minutes:parseInt(e/60%60),hours:parseInt(e/3600)}},t.inflateWith=function(e,t){var n=document.getElementById(e),o=n.cloneNode(!0);return o.innerHTML=o.innerHTML.replace(/\{(.+?)\}/g,function(e,n){return null==t[n]?"":t[n]}),document.importNode(o.content,!0)},t.storageGet=function(e){var t=JSON.parse(window.localStorage.appData||"{}");return t[e]?t[e]:null},t.storagePut=function(e,t){var n=JSON.parse(window.localStorage.appData||"{}");n[e]=t,window.localStorage.appData=JSON.stringify(n)},t}(CONST);!function(e,t){"use strict";function n(){console.error("New schedule data appears to be malformed. Please, try again refreshing the page. If the problem persists please contact us")}function o(){var e=document.createElement("div");return W.days.forEach(function(n){e.appendChild(t.inflateWith("scheduleDay",n));var o=e.children[e.children.length-1],i=o.getElementsByTagName("table")[0];n.events.forEach(function(e){i.tBodies[0].appendChild(t.inflateWith("scheduleRow",e))})}),e}function i(){W.days.forEach(function(e){e.startTmsp=t.dateToSeconds(e.date)+60*parseInt(W.baseTimeOffset),e.endTmsp=e.startTmsp+86400+60*parseInt(W.baseTimeOffset),e.events.forEach(function(n){n.startTmsp=e.startTmsp+t.hourToSeconds(n.startHour),n.endHour?n.endTmsp=e.startTmsp+t.hourToSeconds(n.endHour):n.endTmsp=n.startTmsp})})}function a(){var n=document.createElement("ul");return W.days.forEach(function(o){n.appendChild(t.inflateWith("fancyTitle",o));for(var i=0,a=o.events[i].startTmsp,s=o.startTmsp;s<o.startTmsp+86400;s+=e.SCHEDULE_STEP){n.appendChild(t.inflateWith("fancyItem",{startTmsp:s,endTmsp:s+e.SCHEDULE_STEP-1}));for(var c=n.children[n.children.length-1];a<s+e.SCHEDULE_STEP&&i<o.events.length;){if(c.appendChild(t.inflateWith("fancyEvent",o.events[i])),f(o.events[i].id)){c.children[c.children.length-1].classList.add("subscribed")}i++,i<o.events.length&&(a=o.events[i].startTmsp)}}}),n}function s(){for(var n=document.querySelectorAll("[data-end-timestamp]"),o=t.getNowSeconds(),i=0;i<n.length;i++)n[i].dataset.endTimestamp<o?(n[i].classList.add(e.HAPPENED_CLASS),n[i].dataset.endAction&&K[n[i].dataset.endAction]&&K[n[i].dataset.endAction](n[i])):n[i].dataset.startTimestamp<o&&(n[i].classList.add(e.HAPPENING_CLASS),n[i].dataset.startAction&&K[n[i].dataset.startAction]&&K[n[i].dataset.startAction](n[i])),n[i].dataset.updateAction&&K[n[i].dataset.updateAction]&&K[n[i].dataset.updateAction](n[i])}function c(){var e=document.querySelectorAll(".events-fancy"),t=document.getElementById(x.schedule);try{for(var i=a(),s=0;s<e.length;s++)e[s].innerHTML="<div class='hide-scroll-hack'></div>",e[s].appendChild(i.cloneNode(!0));for(var c=document.querySelectorAll(".events-fancy .event"),s=0;s<c.length;s++)!function(e){e.addEventListener("click",function(){f(e.dataset.eventId)?u(e.dataset.eventId):l(e.dataset.eventId)})}(c[s]);t.innerHTML="",t.appendChild(o().cloneNode(!0))}catch(e){console.error(e),n()}}function r(){var n=t.dateToSeconds(W.countdownStart)+60*parseInt(W.baseTimeOffset),o=!1,i={hours:0,minutes:0,seconds:0},a=t.getNowSeconds()-n,s=e.HACKATHON_DURATION-a;s>0&&s<e.HACKATHON_DURATION?(i=t.getHumanTime(s),o=!0):s>e.HACKATHON_DURATION&&(i.hours=36);for(var c=t.inflateWith("countdownTimerTemplate",{hours:t.pad(i.hours)+":"+t.pad(i.minutes),seconds:t.pad(i.seconds),running:o?"run":"stop"}),r=document.querySelectorAll(".countdown"),d=0;d<r.length;d++)r[d].innerHTML="",r[d].appendChild(c.cloneNode(!0))}function d(e,n,o,i,a,s){var c=t.inflateWith("promptTemplate",{title:e,message:n,accept:o||"Ok",cancel:a||"Cancel"});P.appendChild(c);var r=document.querySelector(".prompt");document.getElementById("promptAccept").addEventListener("click",function(){i&&i(),t.unveil(k),t.fadeOut(r,function(){P.removeChild(r)})}),document.getElementById("promptCancel").addEventListener("click",function(){s&&s(),t.unveil(k),t.fadeOut(r,function(){P.removeChild(r)})}),t.veil(k),t.show(r),setTimeout(function(){t.fadeIn(r)},1)}function l(e){var n=t.storageGet("eventSubscriptions");if(n&&n[e]){n[e].subscribed=!0;var o=document.querySelectorAll("[data-event-id='"+e+"']");if(o&&o.length>0)for(var i=0;i<o.length;i++)o[i].classList.add("subscribed");t.storagePut("eventSubscriptions",n)}}function u(e){var n=t.storageGet("eventSubscriptions");if(n&&n[e]){n[e].subscribed=!1;var o=document.querySelectorAll("[data-event-id='"+e+"']");if(o&&o.length>0)for(var i=0;i<o.length;i++)o[i].classList.remove("subscribed")}t.storagePut("eventSubscriptions",n)}function f(e){var n=t.storageGet("eventSubscriptions");return!(!n||!n[e])&&n[e].subscribed}function h(){var e=t.storageGet("eventSubscriptions");for(var n in e)e.hasOwnProperty(n)&&t.getNowSeconds()-e[n].startTmsp<0&&l(n)}function m(e){var n=t.storageGet("eventSubscriptions");return n&&n[e]?n[e]:null}function E(e){d("Don't miss anything!","Do you want to subscribe to all the events? You will receive a notification before something happens. You can choose to subscribe/unsubscribe by clicking individually on an event.","Do it!",function(){e&&e()},"No, thanks. I'll choose manually",function(){}),t.storagePut("askedSubscribeAll",!0)}function p(){t.storageGet("askedSubscribeAll")||E(function(){h()})}function v(){var e=t.storageGet("eventSubscriptions"),n={};W.days.forEach(function(t){t.events.forEach(function(t){n[t.id]=t,n[t.id].subscribed=!1,e&&e[t.id]&&(n[t.id].subscribed=e[t.id].subscribed)})}),t.storagePut("eventSubscriptions",n)}function T(e){t.loadFile("assets/data/schedule.json?date="+(new Date).getTime(),function(t){var o=JSON.parse(t);o.version||n(),W.version!=o.version?(W=o,i(),v(),"function"==typeof e&&e(),console.info("Schedule updated on ("+new Date+"): \n"+W.message)):console.info("Schedule up to date")},function(e){console.error("Error getting schedule: "+e)})}function S(t){for(var n=document.querySelectorAll("[data-bind-view]"),o=0;o<n.length;o++)n[o].dataset.bindView==t?n[o].classList.add(e.SELECTED_CLASS):n[o].classList.remove(e.SELECTED_CLASS)}function I(e){window.location.hash="/"+e}function L(){if(window.location.hash&&-1!=window.location.hash.indexOf("/")){var t=window.location.hash.slice(window.location.hash.indexOf("/")+1);x[t]?(S(t),w(t)):(console.warn("View '"+t+"' doesn't exist. Showing default ("+e.DEFAULT_VIEW+")."),I(e.DEFAULT_VIEW))}else I(e.DEFAULT_VIEW);b()}function A(t){for(var n=0;n<R.length;n++)R[n].classList.remove(e.ACTIVE_CLASS);document.getElementById(t).classList.add(e.ACTIVE_CLASS)}function g(){G?(C(),G=!1):(y(),G=!0)}function C(){t.fadeOut(P,function(){t.show(M),t.show(V),A(window.location.hash.slice(window.location.hash.indexOf("/")+1)),t.fadeIn(P)})}function y(){t.fadeOut(P,function(){t.hide(M),t.hide(V),A(x.fullscreen),t.fadeIn(P)})}function w(e){t.fadeOut(k,function(){A(e),t.fadeIn(k)})}function N(t,n,o,i){var a=n||e.DEFAULT_NOTIFICATION_TITLE,s=new Notification(a,{body:t,icon:o||e.DEFAULT_NOTIFICATION_ICON});s.onclick=function(){"function"==typeof i&&i(),s.close()},setTimeout(function(){s.close()},e.NOTIFICATION_TIMEOUT)}function _(){document.body.scrollTop=0,t.blockScroll(P),B.classList.remove("hidden"),setTimeout(function(){B.classList.remove("closed")},1),t.veil(P)}function b(){t.unveil(P),B.classList.add("closed"),setTimeout(function(){B.classList.add("hidden"),t.releaseScroll(P)},e.ASIDE_OPEN_TIME)}function O(e){t.loadFile("https://hardware.mlh.io/events/hackupc-winter.json?date="+(new Date).getTime(),function(e){var n=JSON.parse(e).data,o=document.getElementById("hardwareList");o.innerHTML="",n.forEach(function(e){o.appendChild(t.inflateWith("hardwareElem",e))})})}function D(){return"content"in document.createElement("template")}function H(){"Notification"in window?"denied"!==Notification.permission&&Notification.requestPermission(function(e){"granted"===e&&(q=!0)}):console.warn("This browser does not support desktop notification")}function F(){P=document.body,k=document.getElementsByTagName("main")[0],M=document.getElementById("header-nav-bar"),V=document.getElementById("header-small"),B=document.getElementById("aside-small-menu"),R=document.querySelectorAll("body main > article"),window.addEventListener("hashchange",L),document.addEventListener("keypress",function(e){var t=e.which;"p"==String.fromCharCode(t)&&g()}),document.getElementById("countdown-li").addEventListener("click",function(){I(x.live)}),document.getElementById("open-aside-btn").addEventListener("click",function(){_()}),document.getElementById("close-aside-btn").addEventListener("click",function(){b()})}function U(){T(function(){var e="<article  style='color:white' class='active' id='schedule'>";W.days.forEach(function(t){e+="<h1>"+t.name+"</h1><table><thead style='color:black;background-color:white'><tr><th>Location</th><th>Start</th><th>End</th><th>Title</th><th>Description</th></tr></thead>",t.events.forEach(function(t){e+="<tr><td>"+t.locationName+"</td><td>"+t.startHour+"</td><td>"+t.endHour+"</td><td>"+t.title+"</td><td>"+t.description+"</td></tr>"}),e+="</table>"}),e+="</article>",document.body.innerHTML=e})}var P,k,M,V,B,R,W={version:-1},q=!1,G=!1,x={fullscreen:"fullscreen",live:"live",dayof:"dayof",rules:"rules",hardware:"hardware",faq:"faq",schedule:"schedule",challenges:"challenges"},J={logo:"favicon.ico"},K={updateFancyEvent:function(n){if(f(n.dataset.eventId)){var o=n.dataset.startTimestamp-t.getNowSeconds();if(o<=e.EVENT_NOTIF_OFFSET&&o>=0){var i=m(n.dataset.eventId);N(i.description,"Happening soon: "+i.title),u(n.dataset.eventId)}}},removeParent:function(e){e.parentElement.parentElement&&e.parentElement.parentElement.removeChild(e.parentElement)},removeEmptyStep:function(e){0===e.children.length&&e.parentElement.removeChild(e)},removeEndedEvent:function(e){var t=e.parentElement;t.removeChild(e),0===t.children.length&&t.parentElement.removeChild(t)}};document.addEventListener("DOMContentLoaded",function(n){if(O(),!D())return U(),void alert("Please update your browser");T(function(){F(),c(),s(),r(),L(),H(),setTimeout(function(){p()},1e3),setInterval(function(){T(function(){N(W.message,"Schedule changed!",J.logo,function(){I(x.schedule)}),t.fadeOut(k,function(){c(),s(),setTimeout(function(){t.fadeIn(k)},1.2*e.FADE_TIME)})})},e.SCHEDULE_REFRESH_INTERVAL),setInterval(function(){r()},1e3),setInterval(function(){s()},6e4)}),setInterval(function(){O()},6e4)})}(CONST,Util);